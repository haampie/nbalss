%!TEX options = -shell-escape
\documentclass[a4paper]{article}

\usepackage{amsmath, amssymb}
\usepackage{listings}
\usepackage{courier}
\usepackage{color}
\usepackage{pgfplots}
\usepackage{subcaption}
\usepackage{fontspec}
\usepackage{minted}
\usepackage{fullpage}
\setmonofont{DejaVu Sans Mono}

\pgfplotsset{compat=newest}
\usetikzlibrary{plotmarks}
\usetikzlibrary{arrows.meta}
\usepgfplotslibrary{patchplots}

\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\DeclareMathOperator{\diag}{diag}

\author{H.T. Stoppels (University of Groningen)}
\title{{\sc nbalss} homework 4}

\begin{document}
  \maketitle 

  \noindent Some more stuff.

  \paragraph{1} In Figure~\ref{fig:solutions} we see three non-trivial solutions at $\mu = 200,$ together with their norms as $\mu$ gets larger.


  \begin{figure}[h]
    \begin{subfigure}[b]{0.5\textwidth}
      \input{images/two_norm.tikz}
      \caption{Two-norm}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \input{images/three_solutions.tikz}
      \caption{First three non-trivial solutions at $\mu = 200$}
    \end{subfigure}
    \caption{First non-trivial solutions}
    \label{fig:solutions}
  \end{figure}

  \paragraph{4} Here we get

  \begin{figure}[h]
    \begin{subfigure}[t]{0.5\textwidth}
      \input{images/ex4.tikz}
      \caption{Using the non-zero right-hand side, we get on the branch of non-trivial solutions only via continuation between $\mu = 0$ to $\mu = 50.$}
    \end{subfigure}~
    \begin{subfigure}[t]{0.5\textwidth}
      \input{images/newton_iters_4-3.tikz}
      \caption{Number of Newton iterations in $\mu = 0$ to $\mu = 50.$}
    \end{subfigure}
  \end{figure}

  \begin{minted}[fontsize=\scriptsize]{julia}
function buckling_plus_ɛ(θ::Vector{Float64}, μ::Float64, ɛ::Float64, k::Int64)
  n = length(θ);
  h = 1 / (n + 1);
  A = Poisson1D(n);
  rhs = ɛ * sin(k * pi * linspace(h, 1 - h, n));
  return A * θ + (μ * sin(θ) - rhs) * h ^ 2;
end

function ex4_3(; n::Int64 = 1000, k::Int64 = 1, ɛ::Float64 = 0.1, tol::Float64 = 1e-8)
  θ = zeros(n);

  for μ = linspace(0, 50, 100)
    (θ, its) = newton(x -> buckling_plus_ɛ(x, μ, ɛ, k), x -> ∂buckling(x, μ), θ, tol);

    println(length(its))
  end

  return θ;
end
  \end{minted}
\end{document}